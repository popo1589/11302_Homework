學期報告
====
> 指導老師：陳佑全博士<br/>
> 學生：朱皓菱 <br/>
> 題目：桃竹苗區域之醫療安全議題 <br/>
> 日期：114年6月4日

# 壹、緣起目的 (0.3頁)

* 本學期課程涵蓋紅隊（滲透測試）與藍隊（資通安全）兩大領域，透過貫穿網路攻防完整流程的方式，培養學生兼顧理論研討與實務操作之能力。
* 本報告以假想政府資安部門角度，選擇桃竹苗地區的大型研究型醫院、消防醫護體系（EMS），以及衛生所之醫療安全作為資安目標，依序進行紅隊及藍隊之策略分析、任務調度與戰術執行等各階段內容，以體現學習成果及對於醫療資通安全攻防全貌之理解與應用能力。 

註：報告引用之資訊皆為假設性或公開資料，僅供學生練習資安分析作業使用，不適用實務應用。

# 貳、參考資訊 (0.7頁)

## 1. 我國醫療資訊安全政策與基礎建設保護

1. **衛生福利部《醫療資訊系統安全維護手冊》（2019）**：規範醫療機構應建立之資訊安全管理架構、存取控制、資產盤點、漏洞掃描、資安事件通報流程等要點。
2. **《個人資料保護法》（2015）**：明確醫療機構在蒐集、處理、利用個人健康資訊（PHI）時之法定義務，包括個資加密、匿名化及個資外洩通報等要求。
3. **資通安全管理法（2018）第2條**：將醫療院所之電子病歷系統（EMR）、醫療影像儲存與傳輸系統（PACS）等列為關鍵資訊基礎設施（CII），依政府公告納入重點保護對象。

## 2. 醫療基礎建設連鎖衝擊

當某一醫療關鍵基礎設施遭到攻擊或故障時，可能引發連鎖效應，造成其他系統或公共安全受到嚴重影響。  
1. **醫院斷電**：若大型研究型醫院之主電力或備用電力系統失效，將導致電子病歷系統（EMR）及呼吸器等生命維持設備停止運作，直接危及重症病患生命。
2. **EMS通訊中斷**：若消防醫護體系（EMS）之急救指揮中心通訊伺服器遭駭，將導致救護車無法接收路況資訊或指揮中心無法監控車輛位置，影響緊急救護時效。
3. **衛生所系統故障**：若區域衛生所之疫情報告系統與疫苗配送系統遭受勒索軟體攻擊，可能使公共衛生決策延誤，影響流行病防治。

因此，醫療基礎建設成為現代國家資安攻防之重點防護對象，駭客可能利用其連鎖效應，發動大規模網路攻擊。

# 參、策略目標分析 (2-3頁)

## 一、策略目的

* 依上級要求，本章以「桃竹苗地區」之醫療安全為目標，進行重要性分析，以作為後續紅隊滲透測試演練及資安防護精進之依據，並聚焦下列三大類醫療基礎設施：大型研究型醫院、消防醫護體系（EMS）、及衛生所。 
* 本節將以確保醫療系統之可用性、機密性及完整性為核心目標，分析各類醫療設施可能遭受之網路攻擊與資安威脅。

## 二、參考資訊

### 1. 駭客思維分析（醫療情境）

駭客於醫療領域之行動準則仍為「成本最低、影響最大」。常見手段包括：  
| 編號 | 攻擊手法                     | 說明 |
|------|------------------------------|------|
| 1    | 醫療設備漏洞掃描             | 透過 Shodan、Censys 等工具搜尋公網上暴露之醫療設備（如 MRI、CT、呼吸器等），並針對已知 CVE 發動攻擊。 |
| 2    | 勒索醫療數據                 | 侵入電子病歷系統（EMR），加密或竊取患者健康資訊（PHI），以高額贖金為要脅。 |
| 3    | 釣魚與社交工程               | 假冒醫院內部郵件或供應商通知，誘使醫護人員下載惡意附件，竊取內部帳密。 |
| 4    | 橫向移動與特權升級           | 利用 Kerberoasting、Pass-the-Hash 等技術，從低權限帳號橫移至伺服器管理員帳戶，進一步控制 EMR 或 PACS 伺服器。 |

### 2. 潛在威脅來源

| 編號 | 威脅類型                 | 攻擊描述 |
|------|--------------------------|----------|
| 1    | 國家級 APT               | - Industroyer2.0 已開始針對醫療系統 SCADA 裝置進行橫向擴散，試圖干擾醫療設備運作。 |
| 2    | 經濟犯罪集團             | - 以醫療資訊為獲利目標，發動勒索或販售病人健康狀況數據。<br>- 可能透過地下論壇招募內部「內鬼」，取得醫療系統後門。 |
| 3    | 恐怖主義                 | - 透過癱瘓醫院急診系統或 EMS 通訊平台，製造社會恐慌與公共安全危機。<br>- 若成功干擾疫苗配送系統，則可能引發區域疾病擴散。 |
| 4    | 業餘駭客與內部人員風險   | - 醫護人員若點擊惡意郵件或使用不安全裝置連網，可能成為攻擊的突破口。<br>- 第三方醫療設備維護商若遭植入惡意程式，也會造成供應鏈風險。 |

### 3. 醫療基礎設施系統簡介

桃竹苗區域醫療基礎設施可分為以下三大類：  
| 編號 | 醫療機構類型         | 系統與功能說明 |
|------|----------------------|----------------|
| 1    | 大型研究型醫院       | - **電子病歷系統（EMR）**：集中管理住院診療紀錄、檢驗檢查結果、用藥資訊等。<br>- **醫療影像儲存與傳輸系統（PACS）**：存取影像檔案並提供遠端診斷。<br>- **實驗室資訊系統（LIS）**：自動化檢驗數據分析與報告。<br>- **住院管理系統**：串聯病房調度、手術排程與醫護工時管理。 |
| 2    | 消防醫護體系（EMS）  | - **急救通訊指揮中心系統**：包含電腦輔助調度（CAD）、救護車 GPS 追蹤與無線電通訊。<br>- **現場醫療設備**：攜帶式心電圖機、行動氧氣分析器與遠端醫療回傳模組。 |
| 3    | 衛生所               | - **基層診療系統**：常見診療軟體、電子處方系統。<br>- **疫情報告系統**：負責地方疫情監測與報告至中央。<br>- **藥品配送管理系統**：追蹤疫苗及藥品存量與配送路徑。 |  

### 4. 各項易遭駭客威脅之情境

| 編號 | 醫療機構類型         | 資安攻擊情境描述 |
|------|----------------------|------------------|
| 1    | 大型研究型醫院       | - 駭客利用 EMR 漏洞（如 SQL 注入、RPC 憑證竊取）侵入病歷庫，竊取患者隱私資訊或植入後門。<br>- 勒索攻擊導致系統中斷，醫師需手寫病歷，錯誤率大增，延誤救治。 |
| 2    | 消防醫護體系（EMS）  | - 攻擊急救通訊指揮中心，切斷 CAD 系統與 GPS 定位資料，使救護車無法即時到達現場。 |
| 3    | 衛生所               | - 衛生所網路若遭勒索軟體攻擊，疫情報告系統無法正常運作，影響公共衛生決策與防疫對策。<br>- 藥品配送系統遭攻陷，造成疫苗或藥品調配錯誤，威脅民眾健康。 | 

## 三、分析評估
後續將聚焦醫療基礎設施分別以：大型研究型醫院為桃園長庚醫院、消防醫護體系（EMS）為新竹EMS指揮中心，以及衛生所為苗栗衛生所，並說明其設施概況。

| 地點 | 設施概況 | 主要系統 | 攻擊價值分析 | 攻擊難度分析 | 攻擊面 | 技術性質 |
|------|----------|----------|----------------|----------------|----------|-------------|
| 桃園長庚醫院 | - 床位數：約 1,200 張<br>- 日均門診量：約 5,000 人次 | - EMR（電子病歷系統）<br>- PACS（影像系統）<br>- LIS（實驗室資訊系統）<br>- 住院管理系統 | 高等：若侵入可竊取或加密大量病患資料，干擾診療決策 | 中高：需利用系統漏洞（如 SQL 注入、權限繞過），並繞過防火牆與分層控管 | 1. 遠端醫師登入介面弱密碼/未啟用 2FA<br>2. 舊版 PACS 存在 CVE，可橫向移動至 EMR | - EMR SQL 注入<br>- PACS 權限提升<br>- 社交工程釣魚<br>- 橫向移動（Kerberoasting、Pass-the-Hash） |
| 新竹 EMS 指揮中心 | - 日均緊急通話：約 200 通 | - CAD（電腦輔助調度）<br>- GPS 追蹤系統<br>- 無線電通訊<br>- 遠端醫療模組 | 高等：攻陷將導致救護派遣失效，影響生命安全 | 中度：需具備 CAD 漏洞與無線協議攔截能力，並突破加密層 | 1. 公網 CAD 接口未啟用 VPN 或憑證過期<br>2. 救護車 LTE-M 未更新，易遭中間人攻擊 | - CAD 漏洞利用<br>- LTE-M 中間人攻擊<br>- 無線電干擾<br>- 社交工程釣魚（針對 EMS 人員） |
| 苗栗衛生所 | - 日均接待量：約 200 人次 | - 基層診療系統<br>- 疫情報告系統<br>- 藥品配送管理系統 | 中等：攻擊將影響疫情報告與藥品調配，危及公共衛生 | 中等：需利用診療系統漏洞（如 RDP），並突破內網隔離 | 1. RDP/VPN 暴露於公網設定不當<br>2. 供應商若遭攻擊，易遭植入惡意程式 | - RDP 漏洞利用<br>- 勒索軟體植入<br>- 社交工程釣魚<br>- 供應鏈風險 |

### 攻擊效益與成本評估  
綜合上述攻擊價值與難度，依序潛在受攻擊優先順序如下：  
| 編號 | 設施名稱             | 攻擊價值 | 攻擊難度 | 影響描述 |
|------|----------------------|----------|----------|-----------|
| 1    | 桃園長庚醫院         | 高       | 中高     | 可竊取大量敏感醫療資料，並造成醫療系統中斷，影響範圍廣泛。 |
| 2    | 新竹 EMS 指揮中心   | 高       | 中       | 可影響緊急救護指派與定位，高度危及病患生命安全。 |
| 3    | 苗栗衛生所           | 中等     | 中等     | 影響地方疫情報告與藥品配送，對公共衛生決策造成延誤。 |

## 四、小結  
本章以「桃園長庚醫院」、「新竹 EMS 指揮中心」及「苗栗衛生所」作為桃竹苗區域醫療安全之攻防擬態，分析各類設施之攻擊價值與難度，排序如下：  
1. 桃園長庚醫院  
2. 新竹 EMS 指揮中心  
3. 苗栗衛生所  

後續應優先針對「桃園長庚醫院」進行紅隊滲透測試演練，以查找醫療系統中之潛在漏洞與攻擊面。接續進行藍隊資安防護作為，確保醫療系統資通安全。

# 肆、紅隊滲透－任務規劃 (2-3頁)

## 一、任務目的  
參據策略分析結果，將以「桃園長庚醫院」作為滲透測試演練目標，並依循 MITRE ATT&CK for Enterprise 框架規劃滲透測試任務作法，說明各階段作業重點，且提供具體時間表與成果指標。<!--修訂：將目標替換為「桃園長庚醫院」，並改為使用 MITRE ATT&CK for Enterprise 框架-->

## 二、參考資訊

### 駭客方法論  
MITRE ATT&CK for Enterprise 為一套涵蓋初始訪問、執行、持久性、特權提升、防禦規避、橫向移動、資料擷取等技術細分的攻擊框架，可協助紅隊模擬各種常見攻擊手法。  
為簡化說明，以下以通用之四階段方法論作為本次滲透測試流程參考：  
1. **情報蒐集**（Reconnaissance）：收集目標環境與外部暴露資訊，識別潛在漏洞。<!--修訂：以醫療環境為背景說明階段名稱-->  
2. **戰具整備**（Weaponization）：製作或取得所需惡意程式碼與工具，佈署測試平臺與攻擊模組。<!--修訂：保留階段名稱但內容貼合醫療紅隊需求-->  
3. **滲透潛伏**（Penetration）：發動針對性攻擊，取得系統控制權並建立持久性後門。<!--修訂：調整術語符合 MITRE ATT&CK 用語-->  
4. **攻擊破壞**（Actions on Objectives）：模擬資料外洩、系統干擾或醫療設備操控，展現最終攻擊目的與影響。<!--修訂：內容針對醫療目標說明-->

## 三、任務規劃

### 作業規劃  
以下就各階段工作安排，說明作業內容、時間安排及測試方法。  

1. **情報蒐集**  
   - **使用時間**：2 週。<!--修訂：保留原結構，但目標為醫療系統-->  
   - **作業內容**：使用 Shodan、Nmap 、FOFA 等工具，蒐集桃園長庚醫院外部網路暴露面與公網服務；同時透過公開資料及 OSINT 技術掌握內部網路架構、員工職務與社交媒體動態。<!--修訂：蒐集工具與內容針對醫院環境-->  
   - **作業產出**：  
     * **潛在人員清單**  
       - 目標系統管理員及醫IT部門成員職務資訊  
       - 目標醫護人員社交媒體帳號  
       - 目標員工電子郵件列表  
     * **潛在系統目標清單**  
       - 公網暴露 IP 清單（如 EMR 遠端登入介面、PACS VPN 伺服器）  
       - 開放埠號與服務清單（如 RDP、HTTPS、DICOM TCP）  
       - 內部伺服器版本與已知漏洞清單（如舊版 Windows Server、未更新的 PACS 套件）  

2. **戰具整備**  
   - **使用時間**：1 週。  
   - **作業內容**：準備滲透測試所需工具與環境，包括：  
     1. 安裝與配置 Kali Linux、Parrot Security 等滲透測試作業系統  
     2. 部署模擬內部環境之虛擬機（搭建 EMR 及 PACS 模擬伺服器）  
     3. 建立攻擊模組與自訂腳本，涵蓋針對醫療系統的常見利用程式（如 Cobalt Strike Beacon、Impacket 工具集、DICOM Exploitation 模組）  
   - **作業產出**：  
     * **工具清單**  
       - 已安裝並配置之滲透測試工具（Metasploit、Cobalt Strike、Impacket、SQLmap、Burp Suite Pro）  
       - 自訂腳本與模組清單（如針對 EMR 網頁 SQL 注入測試腳本、PACS 權限繞過模組）  
     * **測試環境**  
       - 已建置之虛擬測試環境（含模擬 EMR 伺服器、PACS 伺服器與資料庫）  
       - 攻擊模擬計畫與測試範例（包含初始登入模擬、顯示 DICOM 影像檔存取流程）  

3. **滲透潛伏**  
   - **使用時間**：2 週。  
   - **作業內容**：執行針對桃園長庚醫院之滲透測試，分別從以下向量進行：  
     1. **外部攻擊**：對公網暴露之 EMR 遠端登入介面進行弱密碼或釣魚測試，並測試多因素驗證繞過流。  
     2. **內部橫向移動**：若首次取得低權限憑證，使用 Kerberoasting、Pass-the-Hash 技術嘗試存取內部 PACS 伺服器。  
     3. **醫療設備利用**：掃描內部網段之 DICOM 通訊埠，針對已知 CVE 嘗試控制 PACS 或影像工作站。  
     4. **後門建立**：成功控制伺服器後，部署反向 Shell 或 Cobalt Strike Beacon，並設定開機自啟及隱蔽策略。  
   - **作業產出**：  
     * **入侵成功報告**  
       - 成功取得的伺服器列表（如 EMR Web Server、PACS Server）  
       - 獲取之高權限憑證與系統管理存取權限  
     * **後門配置**  
       - 已部署後門工具與隱蔽技術說明（如改寫系統排程、任務排程隱蔽）  
       - 持久性存取策略與測試結果（成功重開機後連線狀況）  

4. **攻擊破壞**  
   - **使用時間**：1 週。  
   - **作業內容**：以資料分析方式，說明駭客可能對桃園長庚醫院進行之攻擊手法與影響，模擬如下情境：  
     1. **資料竊取**：從 EMR 資料庫擷取大量患者敏感健康資訊，評估外洩範圍與影響。  
     2. **系統癱瘓**：模擬對 PACS 伺服器注入惡意程式碼，造成醫療影像服務中斷，分析對診斷流程之衝擊。  
     3. **設備操控**：針對醫療 IoT 裝置（如血壓監測儀、呼吸器）進行命令植入，評估可能造成之生命威脅。  
   - **作業產出**：  
     * **模擬攻擊說明簡報**  
       - 攻擊手法與流程圖（包含初始入侵、橫向移動、後門部署至最終破壞）  
       - 攻擊影響評估（如醫療服務中斷時間、資料外洩量）與建議改進措施（如分段網路隔離、多因素驗證優化）  

### 人力與工具清單  
* **人力**：  
  * **測試領隊** 1 名：負責整體測試規劃與協調。  
  * **專案經理** 1 名：負責行政事務、專案進度與報告撰寫。  
  * **測試工程師** 4 名：負責醫療系統情蒐與滲透測試。<!--修訂：角色說明貼合醫療滲透測試需求-->  

* **硬體**：  
  * **高階筆記型電腦** 5 台：Intel Core i7、16GB RAM、1TB SSD，預裝 Kali Linux 或 Parrot Security。<!--修訂：標示預裝作業系統-->  

* **軟體**：  
  * **Kali Linux 2024.3**  
  * **Cobalt Strike 4.6**  
  * **Impacket v0.9.28**  
  * **Metasploit 6.2.33**  
  * **SQLmap 1.7.4**  
  * **Burp Suite Pro 2024 版**  
  * **DICOM Exploitation 模組**（自訂） <!--修訂：新增醫療影像針對性工具-->  

### 成果度量指標  
1. **攻擊面分析報告**：包含桃園長庚醫院公網暴露面、內部網路拓樸與潛在漏洞清單，以及各項攻擊價值評估。<!--修訂：度量指標貼合醫療目標-->  
2. **滲透測試報告**：包含已成功入侵伺服器清單（EMR、PACS 等）、獲取之高權限憑證與存取權限，以及滲透流程與所用技巧。  
3. **模擬攻擊報告**：包含攻擊手法流程圖、資料外洩量與系統中斷時間統計，並提出具體建議改進措施（如網路分區建議、多層防護機制）。  

## 四、小結  
本章依據「桃園長庚醫院」之資安威脅模型，針對紅隊滲透測試任務規劃共分為四個階段，並為每階段提供具體時間表與成果指標，以確保測試過程可管理與可追蹤。後續可依測試結果，拓展至「新竹 EMS 指揮中心」及「苗栗衛生所」之模擬滲透，循序進行紅隊及藍隊防禦策略驗證。<!--修訂：小結內容改為醫療環境並銜接後續 -->

# 伍、紅隊滲透－技術準備 (各階段2頁)

## 一、網路情蒐（文字介紹）  
* **網路情蒐的目的為**：釐清桃園長庚醫院公網與內部網路架構，識別公開服務與潛在攻擊面，並蒐集醫院相關員工與設備資訊，以作為後續滲透測試之依據。<!--修訂：將通用情蒐目的改為針對醫院環境-->  
* **蒐集流程說明**：  
  1. **目標範圍確認**：先確認桃園長庚醫院二級網域（如 *.cgmh.org.tw）及公網IP範圍，並蒐集子網域與相關DNS記錄。<!--修訂：新增醫院網域範例-->  
  2. **工具選擇**：主要使用 Shodan、FOFA、Nmap 等工具，搭配 Google Dork 與漏掃平臺，收集醫療系統相關資訊。<!--修訂：針對醫療環境列出工具與方法-->  
  3. **開放服務掃描**：利用 Nmap 對公網 IP 執行掃描，識別開放埠與服務，並標記可能之 EMR 遠端登入介面（如 HTTPS/443、RDP/3389、DICOM/104）。<!--修訂：範例服務貼合醫療系統-->  
  4. **漏洞與版本資訊**：針對掃描結果，查詢對應服務之版本與已知 CVE，並整理易受攻擊之伺服器清單。<!--修訂：強調醫療伺服器版本查詢-->  

* **以下以 Nmap 示範情蒐工具操作做法**：  
  ```bash
  # Nmap S 識別桃園長庚醫院特定 IP 的開放埠與服務版本
  nmap -sV -Pn -p 22,80,443,3389,104 203.72.48.10
  ```
  - **說明**：此命令會針對 IP 203.72.48.10（桃園長庚醫院 EMR 伺服器範例 IP）偵測 SSH（22）、HTTP（80）、HTTPS（443）、RDP（3389）與 DICOM（104）服務，並顯示版本資訊。<!--修訂：範例改為 EMR 伺服器掃描-->  
  - **結果分析**：若發現 RDP/3389 開放且未強制多因素驗證，即為高風險目標；若 DICOM/104 開放，可進行進一步醫療影像服務探測。<!--修訂：針對醫療服務制定風險評估-->  

## 二、戰具整備（CTF 例題）  
* **戰具整備的目的為**：根據網路情蒐階段所發現之桃園長庚醫院範例漏洞與攻擊面，準備相對應之滲透工具、模組與攻擊腳本，以模擬真實攻擊手法。<!--修訂：戰具整備目的改為針對醫院環境-->  
* **CPT（醫療CTF）示範工具準備**：以下以「HospitalCTF-Web」為例，模擬針對 EMR 網頁應用之漏洞整備工具流程：  
  1. **下載題目檔案**：取得 CTF 題目「HospitalCTF-Web」，其內含一個模擬醫院 EMR 網站與後端資料庫。<!--新增：使用醫療場景 CTF 題目-->  
  2. **分析程式碼**：使用 Visual Studio Code 開啟前端與後端程式碼，確認關鍵頁面如登入介面、病歷查詢介面所在路徑與參數。<!--修訂：說明分析 EMR 網站程式碼步驟-->  
  3. **部署測試環境**：在 Kali Linux 中啟動 Docker 容器，執行 `docker-compose up -d`，啟動模擬 EMR 網站與 MySQL 資料庫。  
  4. **準備漏洞利用腳本**：根據情蒐階段取得的版本資訊，若 EMR 使用 PHP 7.2 且 MySQL 5.7，可針對已知 SQL 注入漏洞編寫 Python 腳本：  
     ```python
     # exploit_emr_sqli.py
     import requests

     target = "http://localhost:8080/login"
     payload = "' OR '1'='1'-- "
     data = {"username": payload, "password": "password"}
     r = requests.post(target, data=data)
     if "Welcome" in r.text:
         print("[+] SQLi 成功，已登入所有帳號")
     else:
         print("[-] SQLi 失敗")
     ```
     <!--修訂：針對醫院 EMR SQLi 編寫範例腳本-->  

* **作業產出**：  
  * **工具清單**  
    - 已安裝之滲透測試框架（Metasploit、Burp Suite Pro、SQLmap）  
    - 自訂 Python 腳本（如 EMR SQLi、PACS 權限繞過）  
    - Cobalt Strike Beacon 模組（已設定與測試可連回 C2 Server）  
  * **測試環境**  
    - 已建置 Docker 化 HospitalCTF-Web 環境（包含模擬 EMR 與後端資料庫）  
    - 模擬醫療影像服務之 DICOM 伺服器（可用 Orthanc 開源 DICOM Server）  

## 三、滲透入侵（CTF 例題 *2）  
* **滲透入侵的目的為**：透過模擬實際醫療環境中之常見攻擊向量，驗證紅隊是否可成功取得高權限控制權並部署後門，以強化滲透能力與技巧。<!--修訂：針對醫療目標說明滲透目的-->  
* **常見滲透可分為網頁入侵及系統滲透兩種手法**。<!--修訂：保留原意，符合醫療環境需求-->  

### (1) 網頁入侵：以「HospitalCTF-Web」為例說明  
1. **題目背景**：HospitalCTF-Web 模擬桃園長庚醫院 EMR 登入與病歷查詢系統，存在多處參數化查詢缺失與身分驗證邏輯錯誤。<!--修訂：簡述 CTF 題目與環境-->  
2. **操作流程**：  
   1. 使用 Burp Suite Pro 攔截登入請求，分析參數名稱與後端回傳訊息。  
   2. 嘗試對 `username` 與 `search_patient_id` 參數進行 SQL 注入測試，確認是否可繞過登入或查詢任意病歷。  
   3. 若 SQLi 成功，使用改寫後的 payload（如 `admin'--`）登入系統，並嘗試刪除或匯出病歷資料。  
3. **作業產出**：  
   * 成功登入報告：使用 SQL 注入取得 `admin` 權限，並記錄可獲取之資料表結構與敏感欄位（如病歷號、診斷資訊）。  
   * 病歷外洩測試：從資料庫匯出前 100 筆病歷資訊，驗證資料可讀性與敏感度。<!--修訂：明確列出輸出內容與敏感欄位-->  

### (2) 系統滲透：以「HospitalCTF-System」為例說明  
1. **題目背景**：HospitalCTF-System 模擬內部網段之 Windows Server 2016 與 Linux 伺服器，包含一個配置 DICOM 伺服器的 Ubuntu 18.04，並連接至 Windows Active Directory。<!--修訂：描述 CTF 系統環境與架構-->  
2. **操作流程**：  
   1. **外部登入嘗試**：對公網 RDP 端口（3389）進行弱密碼爆破，嘗試取得初步 Windows 權限；  
   2. **橫向移動**：若取得 Windows 低權限帳號，使用 Kerberoasting 工具 `GetUserSPNs.py` 取得 Service Principal Name (SPN)，並利用 John the Ripper 破解 NTLM 雜湊，嘗試提權至 Domain Admin；  
   3. **醫療影像服務利用**：根據情蒐結果，向 Ubuntu 伺服器 DICOM Port 104 發送自訂命令，若存在 CVE-2019-11041 等漏洞，可取得 root 權限；  
   4. **後門建立**：在 Windows Server 與 Ubuntu 伺服器上部署 Cobalt Strike Beacon，並設定為服務自啟。  
3. **作業產出**：  
   * 系統入侵報告：成功取得之 Windows Server 與 Ubuntu 伺服器列表，並列出對應之使用者憑證與權限階層。  
   * 後門配置檔：包含 Cobalt Strike Beacon 隱蔽部署教學與測試結果（如重啟後 Beacon 自動連線情況）。<!--修訂：列出後門配置細節-->  

## 四、模擬攻擊（文字介紹）  
* **模擬攻擊的目的為**：透過已取得的高權限存取，模擬駭客對桃園長庚醫院醫療系統之最終攻擊行為，評估對病患資料安全、診療流程與醫療設備運作之實質威脅。<!--修訂：目的改為醫療系統最終攻擊-->  
* **可包括之模擬行為**：  
  * **演練資料竊取**：從模擬 EMR 資料庫下載患者完整病歷與檢驗報告，並使用 Python 分析柱狀圖或表格呈現潛在外洩量。<!--修訂：針對醫療資料竊取範例-->  
  * **醫療設備操控測試**：模擬 DICOM 伺服器中之影像工作站控制，嘗試修改患者之影像檔案（如 X 光片），觀察是否影響診斷結果。<!--修訂：針對醫療設備操控範例-->  
  * **服務癱瘓模擬**：中斷 EMR 伺服器與 PACS 伺服器的網路連線，觀察模擬醫護人員如何切換至備援系統或手動流程，以及評估回復時間。<!--修訂：針對醫療服務癱瘓範例-->  
  * **急救通訊干擾**：對院內 EMS 模擬通訊伺服器發動 DoS 測試，評估救護車定位與指揮中心之影響，並測試醫院災難回復計畫。<!--新增：急救通訊干擾範例-->  

# 陸、藍隊防護－任務規劃 (2-3頁)

## 一、任務目的  
依據策略分析結果，需防護「桃園長庚醫院」資訊系統安全。  
本章針對桃園長庚醫院為目標，規劃資通安全防護作為，說明各階段作業重點，並提供具體時間表與成果指標。<!--修訂：將防護目標由「翡翠水庫」改為「桃園長庚醫院」-->

## 二、參考資訊

### 防護方法論  
Cyber Defense Matrix（CDM）為美國 NIST 提出之資安防護框架，分為以下五個階段：  
* **盤點識別**：資產盤點與風險識別。  
* **設置防護**：部署 NGFW、IDS/IPS 與 ACL 規則。  
* **監控偵測**：SIEM 日誌分析與行為基準線設定。  
* **事件應變**：事件通報與緊急演練。  
* **災損復原**：冷備/熱備架構與資料異地備援。  

參酌醫療實務作業，可簡化為四階段方法論（將監控偵測與事件應變合併）：  
1. **盤點識別**  
2. **設置保護**  
3. **監控應變**  
4. **災損復原**  

## 三、任務規劃

### 作業規劃  
以下就各防護階段工作安排，說明作業內容、時間安排及測試方法。  

1. **盤點識別**  
   - **使用時間**：1 週。  
   - **作業內容**：  
     1. **資產清單建立**：蒐集桃園長庚醫院各樓層網路設備、伺服器（EMR、PACS、LIS、AD Domain Controller）與終端裝置（醫療工作站、護理站電腦、醫療 IoT 裝置）等資產清單。  
     2. **網路拓樸繪製**：繪製院內網路分段拓樸圖，標示 DMZ、內部網域、醫療設備區與訪客 Wi-Fi 區。  
     3. **風險分類**：依據資產重要性與暴露情形進行風險評估，分類為高、中、低三個風險等級。  
   - **作業產出**：  
     * **資產清單**（包含設備名稱、IP、用途、風險等級）  
     * **網路拓樸圖**（含VLAN／子網範圍）  
     * **風險分析表**（資產風險等級與主要威脅描述）  

2. **設置保護**  
   - **使用時間**：4 週（不含採購時間）。  
   - **作業內容**：  
     1. **邊界防護**：於醫院網路邊界部署 NGFW，設置嚴格 ACL 規則，限制非必要連線至 EMR、PACS 等關鍵伺服器。  
     2. **入侵偵測/防禦**：部署 IDS/IPS，並調整簽章與行為模型，針對醫療協定（DICOM、HL7）與常見攻擊（SQLi、RDP 暴力）進行偵測。  
     3. **端點保護**：於醫療工作站、護理站電腦與醫療 IoT 裝置安裝 EDR（Endpoint Detection and Response）軟體，啟用勒索軟體防護與可疑行為攔截。  
     4. **存取控制**：強制多因素驗證（MFA）於 EMR 與後台管理介面，並檢視 Active Directory 群組原則，關閉不必要之遠端桌面服務。  
     5. **資料加密與備份**：落實 EMR 資料庫與 PACS 影像資料之靜態加密，啟用定期全量備份與增量備份，並檢測備份完整性。  
   - **作業產出**：  
     * **防護設置圖**（包含 NGFW、IDS/IPS 與端點 EDR 部署位置）  
     * **存取控制規範文件**（EMR、PACS、AD 之帳號與群組策略）  
     * **資料加密與備份計畫**（備份週期、儲存位置、加密方式）  
   - **驗收標準**：  
     * 邊界流量檢測規則通過測試（如封鎖非授權HTTPS／RDP）  
     * EDR 偵測測試（如模擬惡意程式行為被攔截）  
     * 資料庫與影像加密完成且備份可還原  

3. **監控應變**（持續性）  
   - **使用時間**：持續執行，階段性檢討與調整每週。  
   - **作業內容**：  
     1. **日誌收集與 SIEM 建置**：整合 NGFW、IDS/IPS、EDR、Windows Server、Linux 伺服器與醫療工作站之日誌，匯入 SIEM 平台，建立醫療專屬監控看板。  
     2. **行為基準線設定**：根據正常流量與使用模式，設定 EMR、PACS 與 AD 之行為基準，並調整警示閾值。  
     3. **事件通報機制**：制定異常警示標準，如 RDP 登入失敗次數超過 5 次、DICOM 非預期檔案讀取、EMR 數據匯出異常，並自動通知 SOC 團隊。  
     4. **實際應變作業**：當 SIEM 發現異常行為後，啟動 Incident Response 流程，包含初步隔離、取證與通報上級，並依照 SOP 執行緊急演練。  
   - **作業產出**：  
     * **SIEM 儀表板與警示規則**（包含各項醫療系統之偵測指標）  
     * **異常事件記錄與通報工單**（含事件細節、處理步驟與結案報告）  
     * **應變演練報告**（每月或重大更新後之模擬演練結果）  
   - **驗收標準**：  
     * SIEM 警示平均響應時間 <15 分鐘  
     * 每季度演練事件響應演練成功率 100%  

4. **災損復原**  
   - **使用時間**：視實際狀況排定，建議每季至少一次。  
   - **作業內容**：  
     1. **備援架構測試**：驗證 EMR 與 PACS 之冷備/熱備切換流程，確保在主系統故障時可迅速恢復。  
     2. **資料還原演練**：從異地備份系統還原最新備份資料庫與影像檔案，並檢查資料完整性與一致性。  
     3. **異地備援測試**：模擬主要機房失效情境，驗證異地資料中心可支援正常診療作業。  
   - **作業產出**：  
     * **冷備/熱備切換與資料還原測試報告**（含切換時間與資料完整性驗證）  
     * **異地備援演練報告**（包含演練流程、時間記錄與缺失建議）  
   - **驗收標準**：  
     * 冷備/熱備切換完成時間 <4 小時  
     * 異地備援資料完整度 100%  

### 人力與工具清單  
* **人力**：  
  * **SOC 團隊領隊** 1 名：負責整體防護規劃與協調。  
  * **資安工程師** 2 名：負責 NGFW、IDS/IPS、EDR 之部署與維運。  
  * **資安分析師** 2 名：負責 SIEM 日誌分析、行為基準線設定與事件應變。  
  * **系統工程師** 1 名：負責伺服器與備援架構配置與測試。  

* **硬體**：  
  * **安全專用伺服器** 2 台：用於 SIEM 與日誌集中管理。  
  * **網路防火牆（NGFW）** 1 台：支援深度封包檢測與應用層防護。  
  * **入侵防禦系統（IDS/IPS）** 1 台：支援醫療協定偵測。  

* **軟體**：  
  * **SIEM 平台**（例如 Splunk 或 ELK Stack）  
  * **EDR 工具**（例如 CrowdStrike 或 Microsoft Defender for Endpoint）  
  * **IDS/IPS**（例如 Suricata 或 Snort，已套用醫療協定簽章）  
  * **NGFW 作業系統**（例如 Palo Alto PAN-OS）  
  * **備份與還原軟體**（例如 Veeam Backup & Replication）  
  * **遠端管理工具**（例如 Ansible、PowerShell Remoting）  

### 成果度量指標  
* **事件偵測平均時間**：<15 分鐘（從異常產生至 SOC 收到警示）  
* **漏洞修補平均時間**：<72 小時（從漏洞通報至補丁驗證完成）  
* **事件通報與回應流程合格率**：100% （所有異常事件均依 SOP 通報並完成處理）  
* **備援切換測試通過率**：100%（冷備/熱備與資料還原測試皆須達標）  

## 四、小結  
本章依循 CDM 矩陣，針對「桃園長庚醫院」之資安防護任務規劃共分為四個階段，並為每階段提供具體時間表與成果指標，確保醫療系統防護可管理且可度量。後續可依測試與演練結果，持續優化防護策略與作業流程。<!--修訂：小結內容改為醫療環境-->

# 柒、藍隊防護－技術準備 (各階段2頁)

## 一、識別盤點（文字介紹）  
* **識別盤點的目的在於**：建立完整的桃園長庚醫院資產管理與風險評估基礎，確認所有網路設備、伺服器、終端裝置與醫療 IoT 等資產之現況，並評估其安全等級與脆弱性。<!--修訂：說明目的聚焦醫院資產管理-->  
* **以下以 Snipe-IT 示範識別盤點做法**：  
  1. **安裝與啟動**：  
     - 於測試環境中透過 Docker 執行 Snipe-IT：
       ```bash
       # 拉取 Snipe-IT 官方映像檔
       docker pull ghcr.io/snipe/snipe-it:latest

       # 啟動 MySQL 資料庫與 Snipe-IT 容器
       docker network create snipe-net
       docker run -d --name snipe-mysql --network snipe-net \
         -e MYSQL_ROOT_PASSWORD=StrongPass123 \
         -e MYSQL_DATABASE=snipeit \
         -e MYSQL_USER=snipeuser \
         -e MYSQL_PASSWORD=snipepass \
         mysql:5.7

       docker run -d --name snipe-it --network snipe-net \
         -p 8080:80 \
         -e DB_HOST=snipe-mysql \
         -e DB_DATABASE=snipeit \
         -e DB_USERNAME=snipeuser \
         -e DB_PASSWORD=snipepass \
         ghcr.io/snipe/snipe-it:latest
       ```
       <!--修訂：提供基本 Docker 安裝流程-->  
     - 瀏覽器連線至 `http://localhost:8080`，依照官方文件完成初始設定。<!--修訂：說明 UI 初始設定步驟-->  
  2. **新增資產類別**：  
     - 在 Snipe-IT 中建立「伺服器」、「網路設備」、「醫療工作站」、「醫療 IoT 裝置」等類別。  
     - 每個類別設定專屬屬性，如「IP 位址」、「MAC 地址」、「擁有者部門」、「維護週期」等。  
  3. **批次匯入資產**：  
     - 將桃園長庚醫院內部掃描結果（如 Nmap 掃描清單）轉換為 CSV，批次匯入 Snipe-IT。  
     - 確認匯入後之資產資料完整性，並補齊如「所在地點（樓層/機房）」、「重要性等級」等欄位。  
  4. **風險分級與標籤**：  
     - 根據先前風險分析表，為高風險伺服器標記「Critical」標籤，如 EMR 主伺服器、PACS 影像伺服器等。  
     - 定期更新盤點結果，確認新增或退役之資產是否同步反映在 Snipe-IT。  

* **本節內容可選擇性深入或簡單介紹**：  
  - **操作介紹**：詳細可參考官方文件或 YouTube 教學影片，對 Snipe-IT 功能做進一步探索。  
  - **安裝說明**：可參考官方文件（https://snipe-it.readme.io/docs/docker）進行進一步設定與最佳化。<!--保留官方安裝連結，無需修訂-->

## 二、防護設置（CTF 例題）  
* **防護設置的目的在於**：根據先前盤點結果與風險分級，建立針對桃園長庚醫院之資通安全防護機制，並以家栒CTF 例題示範如何在實驗環境中配置防火牆、入侵防禦系統與存取控制策略。<!--修訂：說明目的聚焦醫院防護配置-->  
* **以下以「家栒CTF-Defense」為例示範防護設置工具與流程**：  
  1. **題目背景**：  
     - 家栒CTF-Defense 模擬一個醫院網路環境，包含 EMR 伺服器、PACS 影像伺服器與多個醫療工作站。CTF 題目要求參賽者針對網路邊界與內部通訊設置防護規則，阻擋常見攻擊向量（如 SQLi、RDP 爆破）。  
  2. **防火牆（Firewall）設置示範**：  
     - 在 Ubuntu 伺服器上使用 UFW 作為範例：  
       ```bash
       # 啟用 UFW 並預設拒絕全部連線
       sudo ufw default deny incoming
       sudo ufw default allow outgoing

       # 允許醫院內部網段與 EMR 系統間之 HTTPS 與 DICOM 通訊
       sudo ufw allow proto tcp from 10.0.1.0/24 to any port 443    # EMR HTTPS
       sudo ufw allow proto tcp from 10.0.1.0/24 to any port 104    # DICOM

       # 允許醫護工作站 RDP 連線至特定內部管理伺服器
       sudo ufw allow proto tcp from 10.0.1.0/24 to 10.0.2.10 port 3389

       # 启用防火牆
       sudo ufw enable
       ```  
       <!--修訂：展示針對醫院協定與內部網段的防火牆規則-->  
  3. **入侵防禦系統（IDS/IPS）設置示範**：  
     - 以 Snort 為例，安裝並載入醫療協定簽章：  
       ```bash
       # 安裝 Snort
       sudo apt-get update
       sudo apt-get install -y snort

       # 編輯 Snort 主設定檔 /etc/snort/snort.conf，加入醫療協定簽章路徑
       # 如 rules/dicom.rules 與 rules/emr_http.rules

       # 啟動 Snort 偵測模式
       sudo snort -A console -q -c /etc/snort/snort.conf -i eth0
       ```
       <!--修訂：示範部署 Snort 並載入 DICOM/EMR 簽章-->  
  4. **存取控制示範**：  
     - 於 Windows Server Active Directory 中，於 EMR 伺服器設定只允許特定 AD 群組的帳號遠端登入，並啟用 MFA：  
       1. 建立「EMR_Admins」安全群組，將必要帳號加入。  
       2. 於 EMR 伺服器 GPO（群組原則）中，設定「允許登入本機電腦」僅包含「EMR_Admins」。  
       3. 安裝 Azure MFA Server 或 Duo Security，並強制 AD 帳號登入必須通過雙因素驗證。  
       <!--修訂：示範 AD 存取控制與 MFA 設定-->  

## 三、監控應變（CTF 例題）  
* **監控應變的目的在於**：實時偵測並響應桃園長庚醫院之異常行為與安全事件，透過 SIEM 平台與日誌分析，及時啟動應變流程，減少攻擊對醫療作業之影響。<!--修訂：說明目的貼合醫院監控應變需求-->  
* **以下以「皓菱CTF-SOC」為例示範監控與應變流程**：  
  1. **題目背景**：  
     - 皓菱CTF-SOC 模擬桃園長庚醫院之 SOC 環境，需針對各類日誌（如 EMR Web 伺服器日誌、PACS 讀取日誌、AD 登入失敗日誌）設定警示規則，並在模擬攻擊時進行事件處理。  
  2. **日誌收集與 SIEM 設定**：  
     - 使用 ELK Stack，將各系統日誌匯入 Elasticsearch：  
       ```bash
       # 安裝 Filebeat 並設定輸入來源（EMR、PACS、AD 日誌路徑）
       filebeat.inputs:
       - type: log
         enabled: true
         paths:
           - /var/log/emr_web/*.log
           - /var/log/pacs/*.log
           - /var/log/security/*.evtx

       # 輸出到 Elasticsearch
       output.elasticsearch:
         hosts: ["http://localhost:9200"]
         index: "hospital-logs-%{+yyyy.MM.dd}"
       ```
       <!--修訂：示範 Filebeat 配置匯出醫療系統日誌-->  
     - 在 Kibana 中建立 Dashboard，針對以下事件設置警示：  
       1. EMR 登入失敗超過 5 次 → 通知 SOC 團隊  
       2. DICOM 非授權存取嘗試 → 自動封鎖來源 IP  
       3. AD Domain Admin 帳號異地登入 → 即時發送警示電子郵件  
  3. **應變流程示範**：  
     1. 當 EMR 登入失敗警示觸發時，SOC 人員於 SIEM 平台確認異常來源 IP，並透過防火牆將該 IP 暫時封鎖。  
     2. 收集相關日誌，執行初步取證（如查詢該 IP 在內部網段的行為軌跡）。  
     3. 通知 IT 團隊進行密碼重置與多因素驗證檢查。  
     4. 撰寫事件工單並記錄處理細節，含處理時長與結果。  

## 四、災損鑑識（CTF 例題）  
* **災損鑑識的目的在於**：當桃園長庚醫院發生重大資安事件（如勒索軟體感染或系統被破壞）時，透過取證與鑑識流程，還原事件過程、評估損失範圍並提出改善建議。<!--修訂：說明目的聚焦醫院災損鑑識-->  
* **以下以「裕翔CTF-Forensics」為例示範災損鑑識流程**：  
  1. **題目背景**：  
     - 裕翔CTF-Forensics 模擬 EMR 伺服器遭到勒索程式加密，需參賽者從被感染的映像檔與快照中提取殘留指紋，還原勒索過程並判斷可能的入侵憑證來源。  
  2. **鑑識取證步驟**：  
     1. **快照與磁碟映像擷取**：使用 FTK Imager 將受影響 EMR 磁碟製作映像檔（E01 格式），保存原始證據。  
     2. **記憶體擷取**：使用 LiME 工具將伺服器 RAM 擷取為 raw 檔案，以便後續分析植入之惡意程式。  
     3. **關鍵檔案分析**：  
        - 分析 `%SystemRoot%\System32\Drivers\etc\services` 與 `%SystemRoot%\System32\Drivers\etc\hosts`，尋找是否被惡意修改以進行 C2 隱藏。  
        - 檢查 EMR 日誌資料夾（如 `C:\ProgramData\EMR\logs`）內之加密通知檔案，截取勒索訊息與加密前後檔案 MD5 雜湊值。  
     4. **網路流量分析**：在擷取之封包中，使用 Wireshark 過濾 DICOM TCP 封包與 HTTPS 流量，判斷是否有可疑外流行為。  
     5. **報告撰寫**：  
        - 還原勒索程式入侵時間軸與攻擊路徑（如初始釣魚郵件→SSH 弱密碼爆破→橫向移動→勒索執行）。  
        - 評估資料損失範圍與患者資訊外洩可能性，並提出系統補強建議（如檔案完整性監控、端點防護強化）。  
  
# 陸、結論 (1頁)

本報告針對桃園長庚醫院資通安全攻防進行完整規劃，包括：  
1. **策略目標分析**：以桃園長庚醫院、西竹 EMS 指揮中心與苗栗衛生所為案例，說明醫療基礎設施在桃竹苗區域之關鍵性與潛在威脅，並提出資安防護範圍與假設條件。  
2. **紅隊滲透測試任務規劃與技術準備**：依循 MITRE ATT&CK 框架，設計四階段滲透任務（情報蒐集、戰具整備、滲透潛伏、攻擊破壞），並示範使用 CTF 題目（HospitalCTF-Web、HospitalCTF-System）驗證紅隊技術能力。  
3. **藍隊防護任務規劃與技術準備**：依循 CDM 矩陣，規劃四階段防護（盤點識別、設置保護、監控應變、災損復原），並示範使用各類 CTF 題目（家栒CTF-Defense、皓菱CTF-SOC、裕翔CTF-Forensics）驗證防護能力。  

後續應依實際測試與演練結果持續優化：  
- **延伸至新竹 EMS 與苗栗衛生所**：針對急救通訊與基層診療系統，制定相似之攻防策略與測試案例。  
- **定期演練與審計**：保持紅隊與藍隊能力，並根據最新醫療法規與威脅情報調整防護策略。  
- **多方協作與資訊分享**：與地方衛生局、消防署及其他醫療機構建立通報機制，共同提升桃竹苗區域整體醫療資通安全。  









  






